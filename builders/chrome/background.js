!function(){"use strict";var t,e,r,a={48302:function(t,e,r){r.d(e,{decryptData:function(){return o},encryptData:function(){return i},hashPassword:function(){return c},ko:function(){return s}});var a=r(90749),n=(r(21396),r(17871));function s(t){return a.validateMnemonic(t)}async function i(t,e){try{const r=new Uint8Array(32);crypto.getRandomValues(r);const a=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),n=await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},a,256),s=new Uint8Array(16);crypto.getRandomValues(s);const i=await crypto.subtle.importKey("raw",n,{name:"AES-GCM"},!1,["encrypt"]),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},i,(new TextEncoder).encode(t)),c=new Uint8Array(r.length+s.length+o.byteLength);return c.set(r,0),c.set(s,r.length),c.set(new Uint8Array(o),r.length+s.length),btoa(String.fromCharCode(...Array.from(c)))}catch(t){throw new Error("Encryption failed: "+t)}}async function o(t,e){try{const r=new Uint8Array(atob(t).split("").map(t=>t.charCodeAt(0))),a=r.slice(0,32),n=r.slice(32,48),s=r.slice(48),i=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),o=await crypto.subtle.deriveBits({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},i,256),c=await crypto.subtle.importKey("raw",o,{name:"AES-GCM"},!1,["decrypt"]),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},c,s);return(new TextDecoder).decode(l)}catch(t){return null}}async function c(t){return await n.hash(t,12)}},50042:function(t,e,r){var a=r(17952);function n(){const t=function(t){const e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=Math.floor(256*Math.random());return e}(32);return Array.from(t,t=>t.toString(16).padStart(2,"0")).join("")}function s(t,e){return function(t,e){const r=btoa(t+":"+e);return r}(t,e)}function i(t,e){return function(t,e){try{const r=atob(t).split(":");return r[1]===e?r[0]:null}catch(t){return null}}(t,e)}function o(t,e,r=5,a=30){const n=Date.now();if(e)return{attempts:0,lastAttempt:n,isLocked:!1,lockoutUntil:0};{const e=t.attempts+1,s=e>=r;return{attempts:e,lastAttempt:n,isLocked:s,lockoutUntil:s?n+60*a*1e3:0}}}const c=new a.T,l=new class{constructor(){this.state={isAuthenticated:!1,isWalletUnlocked:!1,autoLockTimeout:15,requirePassword:!0,biometricAuth:!1,failedAttempts:0,lastActivity:Date.now(),session:null},this.rateLimitInfo={attempts:0,lastAttempt:0,isLocked:!1,lockoutUntil:0},this.loadSecuritySettings()}async loadSecuritySettings(){try{const t=await chrome.storage.local.get(["securitySettings","isWalletUnlocked"]);t.securitySettings&&(this.state={...this.state,...t.securitySettings}),void 0!==t.isWalletUnlocked&&(this.state.isWalletUnlocked=t.isWalletUnlocked)}catch(t){}}async saveSecuritySettings(){try{await chrome.storage.local.set({securitySettings:this.state,isWalletUnlocked:this.state.isWalletUnlocked})}catch(t){}}async isWalletUnlocked(){return this.state.isWalletUnlocked}async authenticate(t){const e=function(t,e=5,r=30){const a=Date.now();return t.isLocked&&a<t.lockoutUntil?{isAllowed:!1,remainingAttempts:0,lockoutTime:t.lockoutUntil-a}:t.isLocked&&a>=t.lockoutUntil?{isAllowed:!0,remainingAttempts:e,lockoutTime:0}:t.attempts>=e?{isAllowed:!1,remainingAttempts:0,lockoutTime:60*r*1e3}:{isAllowed:!0,remainingAttempts:e-t.attempts,lockoutTime:0}}(this.rateLimitInfo);if(!e.isAllowed)throw new Error(`Too many failed attempts. Try again in ${Math.ceil(e.lockoutTime/6e4)} minutes.`);try{return await this.getStoredPassword()===t?(this.rateLimitInfo=o(this.rateLimitInfo,!0),this.state.isAuthenticated=!0,this.state.failedAttempts=0,this.state.lastActivity=Date.now(),this.state.session=function(t=60){const e=Date.now();return{isAuthenticated:!0,lastActivity:e,sessionId:n(),expiresAt:e+60*t*1e3}}(this.state.autoLockTimeout),await this.saveSecuritySettings(),!0):(this.rateLimitInfo=o(this.rateLimitInfo,!1),this.state.failedAttempts++,await this.saveSecuritySettings(),!1)}catch(t){return!1}}async unlockWallet(t){const e=await this.authenticate(t);return e&&(this.state.isWalletUnlocked=!0,await this.saveSecuritySettings()),e}async lockWallet(){this.state.isAuthenticated=!1,this.state.isWalletUnlocked=!1,this.state.session=null,await this.saveSecuritySettings()}isSessionValid(){return!!this.state.session&&function(t){const e=Date.now();return t.isAuthenticated&&t.expiresAt>e&&e-t.lastActivity<9e5}(this.state.session)}updateActivity(){var t;this.state.session&&(this.state.session=(t=this.state.session,{...t,lastActivity:Date.now()}),this.state.lastActivity=Date.now())}async performSecurityCheck(){return this.isSessionValid()?(this.updateActivity(),!0):(await this.lockWallet(),!1)}async updateSettings(t){this.state={...this.state,...t},await this.saveSecuritySettings()}getSecurityState(){return{...this.state}}validatePassword(t){return function(t){const e=[];let r=0;return t.length<8?e.push("Password must be at least 8 characters long"):r+=Math.min(t.length-8,4),/[a-z]/.test(t)&&(r+=1),/[A-Z]/.test(t)&&(r+=1),/[0-9]/.test(t)&&(r+=1),/[^A-Za-z0-9]/.test(t)&&(r+=1),/[a-z]/.test(t)||e.push("Add lowercase letters"),/[A-Z]/.test(t)||e.push("Add uppercase letters"),/[0-9]/.test(t)||e.push("Add numbers"),/[^A-Za-z0-9]/.test(t)||e.push("Add special characters"),{isValid:r>=3&&t.length>=8,score:Math.min(r,5),feedback:e}}(t)}async setPassword(t){if(!this.validatePassword(t).isValid)throw new Error("Password does not meet security requirements");await this.storePassword(t)}async storePassword(t){try{const{hashPassword:e}=await Promise.resolve().then(r.bind(r,48302)),a=await e(t),{encryptData:n}=await Promise.resolve().then(r.bind(r,48302)),s=await this.getMasterKey(),i=await n(a,s);await chrome.storage.local.set({encryptedPassword:i,passwordTimestamp:Date.now()})}catch(t){throw t}}async getStoredPassword(){try{const t=await chrome.storage.local.get(["encryptedPassword"]);if(!t.encryptedPassword)return null;const{decryptData:e}=await Promise.resolve().then(r.bind(r,48302)),a=await this.getMasterKey();return await e(t.encryptedPassword,a)}catch(t){return null}}async getMasterKey(){try{const t=navigator.userAgent,e=`${navigator.platform}-${navigator.language}`;return`${t}-${e}-paycio-wallet-2024`}catch(t){throw t}}async secureStore(t,e,r){await function(t,e,r){try{const a=s(JSON.stringify(e),r);chrome.storage.local.set({[t]:a})}catch(t){throw new Error("Failed to store secure data")}}(t,e,r)}async secureRetrieve(t,e){return await function(t,e){try{return new Promise((r,a)=>{chrome.storage.local.get([t],n=>{if(n[t]){const s=i(n[t],e);s?r(JSON.parse(s)):a(new Error("Failed to decrypt data"))}else r(null)})})}catch(t){throw new Error("Failed to retrieve secure data")}}(t,e)}getFailedAttempts(){return this.state.failedAttempts}resetFailedAttempts(){this.state.failedAttempts=0,this.rateLimitInfo={attempts:0,lastAttempt:0,isLocked:!1,lockoutUntil:0}}async isBiometricAvailable(){return!1}async authenticateWithBiometric(){return!1}};chrome.runtime.onInstalled.addListener(t=>{t.reason}),chrome.runtime.onMessage.addListener((t,e,a)=>{switch(t.type){case"WALLET_CONNECT":!async function(t,e){try{const t=c.getCurrentWalletForBackground();e(t?{success:!0,address:t.address,network:t.currentNetwork}:{success:!1,error:"No wallet available"})}catch(t){e({success:!1,error:t instanceof Error?t.message:"Unknown error"})}}(0,a);break;case"WALLET_GET_ACCOUNTS":!async function(t,e){try{const t=c.getCurrentWalletForBackground();e(t?{success:!0,accounts:[t.address]}:{success:!0,accounts:[]})}catch(t){e({success:!1,error:t instanceof Error?t.message:"Unknown error"})}}(0,a);break;case"WALLET_GET_BALANCE":!async function(t,e){try{const{address:r,network:a}=t.params;e({success:!0,balance:await c.getBalance(r,a)})}catch(t){e({success:!1,error:t instanceof Error?t.message:"Unknown error"})}}(t,a);break;case"WALLET_SIGN_TRANSACTION":!async function(t,e){try{if(!c.getCurrentWallet())return void e({success:!1,error:"No wallet available"});const a=c.getCurrentAccount();if(!a)return void e({success:!1,error:"No account available"});const{ethers:n}=await r.e(96).then(r.bind(r,57908)),{decryptData:s}=await Promise.resolve().then(r.bind(r,48302)),{transaction:i,password:o}=t.params;if(!o)return void e({success:!1,error:"Password required for signing"});const l=await s(a.privateKey,o);if(!l)return void e({success:!1,error:"Invalid password"});const u=new n.Wallet(l);e({success:!0,signature:await u.signTransaction(i)})}catch(t){e({success:!1,error:t instanceof Error?t.message:"Unknown error"})}}(t,a);break;case"WALLET_SWITCH_NETWORK":!async function(t,e){try{const{networkId:r}=t.params;await c.switchNetwork(r),e({success:!0})}catch(t){e({success:!1,error:t instanceof Error?t.message:"Unknown error"})}}(t,a);break;default:a({success:!1,error:"Unknown message type"})}return!0}),chrome.alarms.onAlarm.addListener(async t=>{"session_timeout"===t.name&&(await l.lockWallet(),chrome.notifications.create({type:"basic",iconUrl:"assets/icon48.png",title:"PayCio Wallet",message:"Your wallet has been locked due to inactivity."}))}),chrome.storage.local.onChanged.addListener(t=>{t.walletState&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{e[0]&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"WALLET_STATE_CHANGED",data:t.walletState.newValue})})})}},n={};function s(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={id:t,loaded:!1,exports:{}};return a[t].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=a,t=[],s.O=function(e,r,a,n){if(!r){var i=1/0;for(u=0;u<t.length;u++){r=t[u][0],a=t[u][1],n=t[u][2];for(var o=!0,c=0;c<r.length;c++)(!1&n||i>=n)&&Object.keys(s.O).every(function(t){return s.O[t](r[c])})?r.splice(c--,1):(o=!1,n<i&&(i=n));if(o){t.splice(u--,1);var l=a();void 0!==l&&(e=l)}}return e}n=n||0;for(var u=t.length;u>0&&t[u-1][2]>n;u--)t[u]=t[u-1];t[u]=[r,a,n]},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,{a:e}),e},s.d=function(t,e){for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce(function(e,r){return s.f[r](t,e),e},[]))},s.u=function(t){return t+".js"},s.miniCssF=function(t){},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e={},r="paycio-wallet:",s.l=function(t,a,n,i){if(e[t])e[t].push(a);else{var o,c;if(void 0!==n)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==r+n){o=d;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.setAttribute("data-webpack",r+n),o.src=t),e[t]=[a];var h=function(r,a){o.onerror=o.onload=null,clearTimeout(y);var n=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach(function(t){return t(a)}),r)return r(a)},y=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),c&&document.head.appendChild(o)}},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},s.j=471,s.p="",function(){var t={471:0};s.f.j=function(e,r){var a=s.o(t,e)?t[e]:void 0;if(0!==a)if(a)r.push(a[2]);else{var n=new Promise(function(r,n){a=t[e]=[r,n]});r.push(a[2]=n);var i=s.p+s.u(e),o=new Error;s.l(i,function(r){if(s.o(t,e)&&(0!==(a=t[e])&&(t[e]=void 0),a)){var n=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;o.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",o.name="ChunkLoadError",o.type=n,o.request=i,a[1](o)}},"chunk-"+e,e)}},s.O.j=function(e){return 0===t[e]};var e=function(e,r){var a,n,i=r[0],o=r[1],c=r[2],l=0;if(i.some(function(e){return 0!==t[e]})){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(c)var u=c(s)}for(e&&e(r);l<i.length;l++)n=i[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(u)},r=self.webpackChunkpaycio_wallet=self.webpackChunkpaycio_wallet||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var i=s.O(void 0,[96,671],function(){return s(50042)});i=s.O(i)}();