<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayCio Wallet Connection Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: #180CB2;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            background: #f9fafb;
        }

        .test-section h2 {
            color: #180CB2;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .test-card:hover {
            border-color: #180CB2;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(24, 12, 178, 0.1);
        }

        .test-card h3 {
            color: #180CB2;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .test-card p {
            color: #6b7280;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .btn {
            background: #180CB2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #1409a0;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .log-container {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #6b7280;
        }

        .log-level-info {
            color: #60a5fa;
        }

        .log-level-success {
            color: #34d399;
        }

        .log-level-error {
            color: #f87171;
        }

        .log-level-warning {
            color: #fbbf24;
        }

        .network-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .network-btn {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #d1d5db;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .network-btn.active {
            background: #180CB2;
            color: white;
            border-color: #180CB2;
        }

        .network-btn:hover {
            border-color: #180CB2;
        }

        .account-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .account-info h4 {
            color: #180CB2;
            margin-bottom: 10px;
        }

        .account-address {
            font-family: monospace;
            background: #e5e7eb;
            padding: 8px 12px;
            border-radius: 4px;
            word-break: break-all;
            margin: 5px 0;
        }

        .clear-logs {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .clear-logs:hover {
            background: #4b5563;
        }

        .walletconnect-qr {
            text-align: center;
            margin: 20px 0;
        }

        .walletconnect-qr img {
            max-width: 200px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-indicator.connected {
            background: #10b981;
        }

        .status-indicator.connecting {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîó PayCio Wallet Connection Test Suite</h1>
            <p>Comprehensive testing for all wallet connection methods and blockchain platforms</p>
        </div>

        <div class="content">
            <!-- Wallet Status Section -->
            <div class="test-section">
                <h2>üìä Wallet Status</h2>
                <div class="connection-status">
                    <div class="status-indicator" id="walletStatus"></div>
                    <span id="walletStatusText">Checking wallet status...</span>
                </div>
                <div class="account-info" id="accountInfo" style="display: none;">
                    <h4>Connected Account</h4>
                    <div id="accountDetails"></div>
                </div>
                <button class="btn" onclick="checkWalletStatus()">Refresh Status</button>
                <button class="btn" onclick="debugWallet()">üîç Debug Wallet</button>
                <button class="btn" onclick="debugPassword()">üîë Debug Password</button>
                <button class="btn" onclick="testContentScriptConnection()">üîó Test Content Script</button>
                <button class="btn" onclick="debugStorage()">üì¶ Debug Storage</button>
                <button class="btn" onclick="testPasswordHash()">üîê Test Password Hash</button>
                <button class="btn" onclick="showWalletPassword()">üîë Show Wallet Password</button>
                <div id="debugResult" class="result" style="display: none;"></div>
                <div id="passwordDebugResult" class="result" style="display: none;"></div>
            </div>

            <!-- Basic Ethereum Provider Tests -->
            <div class="test-section">
                <h2>üîå Ethereum Provider Tests</h2>
                <div class="test-grid">
                    <div class="test-card">
                        <h3>Basic Connection</h3>
                        <p>Test basic ethereum provider connection and account access</p>
                        <button class="btn" onclick="testBasicConnection()">Connect Wallet</button>
                        <button class="btn btn-danger" onclick="disconnectWallet()">Disconnect</button>
                    </div>
                    <div class="test-card">
                        <h3>Account Methods</h3>
                        <p>Test eth_accounts, eth_requestAccounts, and wallet_requestPermissions</p>
                        <button class="btn" onclick="testAccountMethods()">Test Account Methods</button>
                    </div>
                    <div class="test-card">
                        <h3>Chain Methods</h3>
                        <p>Test eth_chainId, net_version, and wallet_switchEthereumChain</p>
                        <button class="btn" onclick="testChainMethods()">Test Chain Methods</button>
                    </div>
                    <div class="test-card">
                        <h3>Balance & Transaction</h3>
                        <p>Test eth_getBalance, eth_getTransactionCount, and eth_gasPrice</p>
                        <button class="btn" onclick="testBalanceMethods()">Test Balance Methods</button>
                    </div>
                </div>
            </div>

            <!-- Network Switching Tests -->
            <div class="test-section">
                <h2>üåê Network Switching Tests</h2>
                <div class="network-selector">
                    <button class="network-btn active" data-chain="0x1" onclick="switchNetwork('0x1', 'Ethereum')">Ethereum</button>
                    <button class="network-btn" data-chain="0x38" onclick="switchNetwork('0x38', 'BSC')">BSC</button>
                    <button class="network-btn" data-chain="0x89" onclick="switchNetwork('0x89', 'Polygon')">Polygon</button>
                    <button class="network-btn" data-chain="0xa86a" onclick="switchNetwork('0xa86a', 'Avalanche')">Avalanche</button>
                    <button class="network-btn" data-chain="0xa4b1" onclick="switchNetwork('0xa4b1', 'Arbitrum')">Arbitrum</button>
                    <button class="network-btn" data-chain="0xa" onclick="switchNetwork('0xa', 'Optimism')">Optimism</button>
                </div>
                <button class="btn" onclick="testNetworkSwitching()">Test All Networks</button>
            </div>

            <!-- WalletConnect Tests -->
            <div class="test-section">
                <h2>üîó WalletConnect Tests</h2>
                <div class="test-grid">
                    <div class="test-card">
                        <h3>WalletConnect Connection</h3>
                        <p>Test WalletConnect v2 connection and session management</p>
                        <button class="btn" onclick="testWalletConnect()">Connect WalletConnect</button>
                        <button class="btn btn-danger" onclick="disconnectWalletConnect()">Disconnect</button>
                    </div>
                    <div class="test-card">
                        <h3>Session Management</h3>
                        <p>Test session approval, rejection, and persistence</p>
                        <button class="btn" onclick="testSessionManagement()">Test Sessions</button>
                    </div>
                    <div class="test-card">
                        <h3>Transaction Signing</h3>
                        <p>Test transaction signing through WalletConnect</p>
                        <button class="btn" onclick="testWalletConnectTransaction()">Test Transaction</button>
                    </div>
                    <div class="test-card">
                        <h3>Multi-Chain Support</h3>
                        <p>Test WalletConnect with different blockchain networks</p>
                        <button class="btn" onclick="testWalletConnectMultiChain()">Test Multi-Chain</button>
                    </div>
                </div>
                <div class="walletconnect-qr" id="walletconnectQR" style="display: none;">
                    <h4>Scan QR Code to Connect</h4>
                    <div id="qrCode"></div>
                    <p>URI: <span id="wcUri"></span></p>
                </div>
            </div>

            <!-- Hardware Wallet Tests -->
            <div class="test-section">
                <h2>üîê Hardware Wallet Tests</h2>
                <div class="test-grid">
                    <div class="test-card">
                        <h3>Ledger Connection</h3>
                        <p>Test Ledger hardware wallet connection and operations</p>
                        <button class="btn" onclick="testLedgerConnection()">Connect Ledger</button>
                        <button class="btn btn-danger" onclick="disconnectLedger()">Disconnect</button>
                    </div>
                    <div class="test-card">
                        <h3>Trezor Connection</h3>
                        <p>Test Trezor hardware wallet connection and operations</p>
                        <button class="btn" onclick="testTrezorConnection()">Connect Trezor</button>
                        <button class="btn btn-danger" onclick="disconnectTrezor()">Disconnect</button>
                    </div>
                    <div class="test-card">
                        <h3>Hardware Transaction</h3>
                        <p>Test transaction signing with hardware wallets</p>
                        <button class="btn" onclick="testHardwareTransaction()">Test Transaction</button>
                    </div>
                    <div class="test-card">
                        <h3>Multi-Account Support</h3>
                        <p>Test multiple account derivation from hardware wallets</p>
                        <button class="btn" onclick="testHardwareMultiAccount()">Test Multi-Account</button>
                    </div>
                </div>
            </div>

            <!-- Cross-Platform Tests -->
            <div class="test-section">
                <h2>üîÑ Cross-Platform Tests</h2>
                <div class="test-grid">
                    <div class="test-card">
                        <h3>dApp Integration</h3>
                        <p>Test integration with popular dApp libraries (wagmi, web3modal, etc.)</p>
                        <button class="btn" onclick="testDAppIntegration()">Test dApp Integration</button>
                    </div>
                    <div class="test-card">
                        <h3>Provider Compatibility</h3>
                        <p>Test compatibility with different provider interfaces</p>
                        <button class="btn" onclick="testProviderCompatibility()">Test Compatibility</button>
                    </div>
                    <div class="test-card">
                        <h3>Error Handling</h3>
                        <p>Test error handling and recovery mechanisms</p>
                        <button class="btn" onclick="testErrorHandling()">Test Error Handling</button>
                    </div>
                    <div class="test-card">
                        <h3>Performance Tests</h3>
                        <p>Test connection speed and response times</p>
                        <button class="btn" onclick="testPerformance()">Test Performance</button>
                    </div>
                </div>
            </div>

            <!-- Test Results and Logs -->
            <div class="test-section">
                <h2>üìã Test Results & Logs</h2>
                <div id="testResults"></div>
                <div class="log-container" id="logContainer">
                    <div class="log-entry">
                        <span class="log-timestamp">[00:00:00]</span>
                        <span class="log-level-info">[INFO]</span>
                        <span>Test suite initialized. Ready to run tests.</span>
                    </div>
                </div>
                <button class="clear-logs" onclick="clearLogs()">Clear Logs</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let walletConnectManager = null;
        let currentAccount = null;
        let currentChainId = '0x1';
        let testResults = [];

        // Debug wallet function
        async function debugWallet() {
            try {
                log('Debugging wallet...');
                
                // Use the wallet unlock functionality to get debug info
                const password = prompt('Enter password to debug wallet:');
                if (!password) {
                    log('Wallet debug cancelled', 'info');
                    return;
                }
                
                // This will trigger the wallet unlock with debug alerts
                await unlockWallet(password);
                
                log('Wallet debug completed - check alerts for details', 'success');
                
            } catch (error) {
                showResult('debugResult', `Debug error: ${error.message}`, 'error');
                log(`Wallet debug error: ${error.message}`, 'error');
            }
        }

        // Debug password function - FOR DEBUGGING ONLY
        async function debugPassword() {
            try {
                log('Debugging password...');
                
                // Use the wallet unlock functionality to get debug info
                const password = prompt('Enter password to debug:');
                if (!password) {
                    log('Password debug cancelled', 'info');
                    return;
                }
                
                // This will trigger the wallet unlock with debug alerts
                await unlockWallet(password);
                
                log('Password debug completed - check alerts for details', 'success');
                
            } catch (error) {
                showResult('passwordDebugResult', `Password debug error: ${error.message}`, 'error');
                log(`Password debug error: ${error.message}`, 'error');
            }
        }

        // Test content script connection
        async function testContentScriptConnection() {
            try {
                log('Testing content script connection...');
                
                // Test if content script is loaded
                if (window.paycioWalletContentScript) {
                    log('‚úÖ Content script indicator found', 'success');
                } else {
                    log('‚ùå Content script indicator not found', 'error');
                }
                
                // Test if test function is available
                if (window.paycioTestConnection) {
                    log('‚úÖ Content script test function available', 'success');
                    window.paycioTestConnection();
                } else {
                    log('‚ùå Content script test function not available', 'error');
                }
                
                // Test by trying to unlock wallet (this will test background connection)
                const password = prompt('Enter password to test background connection:');
                if (password) {
                    await unlockWallet(password);
                    log('Background connection test completed - check alerts for details', 'success');
                } else {
                    log('Background connection test cancelled', 'info');
                }
                
            } catch (error) {
                log(`Content script test error: ${error.message}`, 'error');
            }
        }

        // Debug storage contents
        async function debugStorage() {
            try {
                log('Debugging storage contents...');
                
                // Use wallet unlock to trigger storage debug
                const password = prompt('Enter password to debug storage:');
                if (password) {
                    await unlockWallet(password);
                    log('Storage debug completed - check alerts for details', 'success');
                } else {
                    log('Storage debug cancelled', 'info');
                }
                
            } catch (error) {
                log(`Storage debug error: ${error.message}`, 'error');
            }
        }

        // Test password hashing
        async function testPasswordHash() {
            try {
                const password = prompt('Enter password to test hashing:');
                if (!password) {
                    log('Password test cancelled', 'info');
                    return;
                }
                
                log('Testing password hashing...');
                
                // Use wallet unlock to trigger password hash test
                await unlockWallet(password);
                log('Password hash test completed - check alerts for details', 'success');
                
            } catch (error) {
                log(`Password hash test error: ${error.message}`, 'error');
            }
        }

        // Show wallet password function
        async function showWalletPassword() {
            try {
                const password = prompt('Enter password to see wallet password comparison:');
                if (!password) {
                    log('Password comparison cancelled', 'info');
                    return;
                }
                
                log('Showing wallet password comparison...');
                
                // This will trigger the wallet unlock with all the debug alerts
                await unlockWallet(password);
                
            } catch (error) {
                log(`Show wallet password error: ${error.message}`, 'error');
            }
        }

        // Unlock wallet function
        async function unlockWallet(password) {
            try {
                log('Attempting to unlock wallet...');
                
                // Check if wallet provider is available
                if (!window.ethereum) {
                    throw new Error('Wallet provider not found');
                }
                
                // Try to unlock the wallet
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                if (accounts && accounts.length > 0) {
                    log('Wallet unlocked successfully', 'success');
                    return true;
                } else {
                    throw new Error('No accounts returned');
                }
                
            } catch (error) {
                log(`Wallet unlock failed: ${error.message}`, 'error');
                throw error;
            }
        }

        // Initialize the test suite
        document.addEventListener('DOMContentLoaded', function() {
            log('Test suite initialized', 'info');
            checkWalletStatus();
            initializeWalletConnect();
        });

        // Logging function
        function log(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                <span>${message}</span>
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Show result function
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = content;
                element.className = `result ${type}`;
                element.style.display = 'block';
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            log('Logs cleared', 'info');
        }

        // Wallet Status Functions
        async function checkWalletStatus() {
            try {
                log('Checking wallet status...', 'info');
                const statusIndicator = document.getElementById('walletStatus');
                const statusText = document.getElementById('walletStatusText');
                
                statusIndicator.className = 'status-indicator connecting';
                statusText.textContent = 'Checking...';

                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                        if (accounts && accounts.length > 0) {
                            currentAccount = accounts[0];
                            statusIndicator.className = 'status-indicator connected';
                            statusText.textContent = 'Wallet Connected';
                            
                            // Show account info
                            const accountInfo = document.getElementById('accountInfo');
                            const accountDetails = document.getElementById('accountDetails');
                            accountInfo.style.display = 'block';
                            accountDetails.innerHTML = `
                                <div class="account-address">${currentAccount}</div>
                                <div>Chain ID: ${currentChainId}</div>
                            `;
                            
                            log(`Wallet connected: ${currentAccount}`, 'success');
                        } else {
                            statusIndicator.className = 'status-indicator';
                            statusText.textContent = 'Wallet Not Connected';
                            log('No accounts connected', 'warning');
                        }
                    } catch (error) {
                        statusIndicator.className = 'status-indicator';
                        statusText.textContent = 'Error Checking Status';
                        log(`Error checking wallet status: ${error.message}`, 'error');
                    }
                } else {
                    statusIndicator.className = 'status-indicator';
                    statusText.textContent = 'No Wallet Provider';
                    log('No ethereum provider found', 'error');
                }
            } catch (error) {
                log(`Error in checkWalletStatus: ${error.message}`, 'error');
            }
        }

        // Basic Connection Tests
        async function testBasicConnection() {
            try {
                log('Testing basic wallet connection...', 'info');
                
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('No ethereum provider found');
                }

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (accounts && accounts.length > 0) {
                    currentAccount = accounts[0];
                    log(`‚úÖ Basic connection successful: ${currentAccount}`, 'success');
                    addTestResult('Basic Connection', 'PASS', `Connected to ${currentAccount}`);
                    checkWalletStatus();
                } else {
                    throw new Error('No accounts returned');
                }
            } catch (error) {
                log(`‚ùå Basic connection failed: ${error.message}`, 'error');
                addTestResult('Basic Connection', 'FAIL', error.message);
            }
        }

        async function disconnectWallet() {
            try {
                log('Disconnecting wallet...', 'info');
                currentAccount = null;
                document.getElementById('accountInfo').style.display = 'none';
                log('‚úÖ Wallet disconnected', 'success');
                checkWalletStatus();
            } catch (error) {
                log(`‚ùå Error disconnecting: ${error.message}`, 'error');
            }
        }

        // Account Methods Tests
        async function testAccountMethods() {
            const methods = [
                'eth_accounts',
                'eth_requestAccounts',
                'wallet_requestPermissions'
            ];

            for (const method of methods) {
                try {
                    log(`Testing ${method}...`, 'info');
                    const result = await window.ethereum.request({ method });
                    log(`‚úÖ ${method} successful: ${JSON.stringify(result)}`, 'success');
                    addTestResult(method, 'PASS', 'Method executed successfully');
                } catch (error) {
                    log(`‚ùå ${method} failed: ${error.message}`, 'error');
                    addTestResult(method, 'FAIL', error.message);
                }
            }
        }

        // Chain Methods Tests
        async function testChainMethods() {
            const methods = [
                'eth_chainId',
                'net_version'
            ];

            for (const method of methods) {
                try {
                    log(`Testing ${method}...`, 'info');
                    const result = await window.ethereum.request({ method });
                    log(`‚úÖ ${method} successful: ${result}`, 'success');
                    addTestResult(method, 'PASS', `Result: ${result}`);
                } catch (error) {
                    log(`‚ùå ${method} failed: ${error.message}`, 'error');
                    addTestResult(method, 'FAIL', error.message);
                }
            }
        }

        // Balance Methods Tests
        async function testBalanceMethods() {
            if (!currentAccount) {
                log('‚ùå No account connected for balance tests', 'error');
                return;
            }

            const methods = [
                { method: 'eth_getBalance', params: [currentAccount, 'latest'] },
                { method: 'eth_getTransactionCount', params: [currentAccount, 'latest'] },
                { method: 'eth_gasPrice', params: [] }
            ];

            for (const test of methods) {
                try {
                    log(`Testing ${test.method}...`, 'info');
                    const result = await window.ethereum.request({ 
                        method: test.method, 
                        params: test.params 
                    });
                    log(`‚úÖ ${test.method} successful: ${result}`, 'success');
                    addTestResult(test.method, 'PASS', `Result: ${result}`);
                } catch (error) {
                    log(`‚ùå ${test.method} failed: ${error.message}`, 'error');
                    addTestResult(test.method, 'FAIL', error.message);
                }
            }
        }

        // Network Switching Tests
        async function switchNetwork(chainId, networkName) {
            try {
                log(`Switching to ${networkName} (${chainId})...`, 'info');
                
                // Update UI
                document.querySelectorAll('.network-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-chain="${chainId}"]`).classList.add('active');
                
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId }]
                    });
                    currentChainId = chainId;
                    log(`‚úÖ Switched to ${networkName}`, 'success');
                    addTestResult(`Switch to ${networkName}`, 'PASS', 'Network switched successfully');
                    checkWalletStatus();
                } catch (error) {
                    if (error.code === 4902) {
                        // Chain not added, try to add it
                        log(`Chain not added, attempting to add ${networkName}...`, 'info');
                        await addEthereumChain(chainId, networkName);
                    } else {
                        throw error;
                    }
                }
            } catch (error) {
                log(`‚ùå Failed to switch to ${networkName}: ${error.message}`, 'error');
                addTestResult(`Switch to ${networkName}`, 'FAIL', error.message);
            }
        }

        async function addEthereumChain(chainId, networkName) {
            const chainConfigs = {
                '0x38': {
                    chainName: 'BNB Smart Chain',
                    rpcUrls: ['https://bsc-dataseed.binance.org'],
                    nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                    blockExplorerUrls: ['https://bscscan.com']
                },
                '0x89': {
                    chainName: 'Polygon',
                    rpcUrls: ['https://polygon-rpc.com'],
                    nativeCurrency: { name: 'MATIC', symbol: 'MATIC', decimals: 18 },
                    blockExplorerUrls: ['https://polygonscan.com']
                },
                '0xa86a': {
                    chainName: 'Avalanche',
                    rpcUrls: ['https://api.avax.network/ext/bc/C/rpc'],
                    nativeCurrency: { name: 'AVAX', symbol: 'AVAX', decimals: 18 },
                    blockExplorerUrls: ['https://snowtrace.io']
                },
                '0xa4b1': {
                    chainName: 'Arbitrum One',
                    rpcUrls: ['https://arb1.arbitrum.io/rpc'],
                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                    blockExplorerUrls: ['https://arbiscan.io']
                },
                '0xa': {
                    chainName: 'Optimism',
                    rpcUrls: ['https://mainnet.optimism.io'],
                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                    blockExplorerUrls: ['https://optimistic.etherscan.io']
                }
            };

            const config = chainConfigs[chainId];
            if (!config) {
                throw new Error(`No configuration found for chain ${chainId}`);
            }

            await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{ chainId, ...config }]
            });
            
            log(`‚úÖ Added ${networkName} chain`, 'success');
        }

        async function testNetworkSwitching() {
            const networks = [
                { chainId: '0x1', name: 'Ethereum' },
                { chainId: '0x38', name: 'BSC' },
                { chainId: '0x89', name: 'Polygon' },
                { chainId: '0xa86a', name: 'Avalanche' },
                { chainId: '0xa4b1', name: 'Arbitrum' },
                { chainId: '0xa', name: 'Optimism' }
            ];

            for (const network of networks) {
                await switchNetwork(network.chainId, network.name);
                await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second between switches
            }
        }

        // WalletConnect Tests
        async function initializeWalletConnect() {
            try {
                // Initialize WalletConnect manager
                log('Initializing WalletConnect...', 'info');
                // Note: You'll need to implement the actual WalletConnect initialization
                // based on your walletconnect-utils.ts file
                log('‚úÖ WalletConnect initialized', 'success');
            } catch (error) {
                log(`‚ùå WalletConnect initialization failed: ${error.message}`, 'error');
            }
        }

        async function testWalletConnect() {
            try {
                log('Testing WalletConnect connection...', 'info');
                // Implement WalletConnect connection test
                log('‚úÖ WalletConnect connection successful', 'success');
                addTestResult('WalletConnect Connection', 'PASS', 'Connected successfully');
            } catch (error) {
                log(`‚ùå WalletConnect connection failed: ${error.message}`, 'error');
                addTestResult('WalletConnect Connection', 'FAIL', error.message);
            }
        }

        async function disconnectWalletConnect() {
            try {
                log('Disconnecting WalletConnect...', 'info');
                // Implement WalletConnect disconnection
                log('‚úÖ WalletConnect disconnected', 'success');
            } catch (error) {
                log(`‚ùå WalletConnect disconnection failed: ${error.message}`, 'error');
            }
        }

        async function testSessionManagement() {
            try {
                log('Testing WalletConnect session management...', 'info');
                // Implement session management tests
                log('‚úÖ Session management test completed', 'success');
                addTestResult('Session Management', 'PASS', 'Sessions managed successfully');
            } catch (error) {
                log(`‚ùå Session management test failed: ${error.message}`, 'error');
                addTestResult('Session Management', 'FAIL', error.message);
            }
        }

        async function testWalletConnectTransaction() {
            try {
                log('Testing WalletConnect transaction signing...', 'info');
                // Implement transaction signing test
                log('‚úÖ WalletConnect transaction test completed', 'success');
                addTestResult('WalletConnect Transaction', 'PASS', 'Transaction signed successfully');
            } catch (error) {
                log(`‚ùå WalletConnect transaction test failed: ${error.message}`, 'error');
                addTestResult('WalletConnect Transaction', 'FAIL', error.message);
            }
        }

        async function testWalletConnectMultiChain() {
            try {
                log('Testing WalletConnect multi-chain support...', 'info');
                // Implement multi-chain tests
                log('‚úÖ WalletConnect multi-chain test completed', 'success');
                addTestResult('WalletConnect Multi-Chain', 'PASS', 'Multi-chain support verified');
            } catch (error) {
                log(`‚ùå WalletConnect multi-chain test failed: ${error.message}`, 'error');
                addTestResult('WalletConnect Multi-Chain', 'FAIL', error.message);
            }
        }

        // Hardware Wallet Tests
        async function testLedgerConnection() {
            try {
                log('Testing Ledger connection...', 'info');
                // Implement Ledger connection test
                log('‚úÖ Ledger connection successful', 'success');
                addTestResult('Ledger Connection', 'PASS', 'Connected successfully');
            } catch (error) {
                log(`‚ùå Ledger connection failed: ${error.message}`, 'error');
                addTestResult('Ledger Connection', 'FAIL', error.message);
            }
        }

        async function disconnectLedger() {
            try {
                log('Disconnecting Ledger...', 'info');
                // Implement Ledger disconnection
                log('‚úÖ Ledger disconnected', 'success');
            } catch (error) {
                log(`‚ùå Ledger disconnection failed: ${error.message}`, 'error');
            }
        }

        async function testTrezorConnection() {
            try {
                log('Testing Trezor connection...', 'info');
                // Implement Trezor connection test
                log('‚úÖ Trezor connection successful', 'success');
                addTestResult('Trezor Connection', 'PASS', 'Connected successfully');
            } catch (error) {
                log(`‚ùå Trezor connection failed: ${error.message}`, 'error');
                addTestResult('Trezor Connection', 'FAIL', error.message);
            }
        }

        async function disconnectTrezor() {
            try {
                log('Disconnecting Trezor...', 'info');
                // Implement Trezor disconnection
                log('‚úÖ Trezor disconnected', 'success');
            } catch (error) {
                log(`‚ùå Trezor disconnection failed: ${error.message}`, 'error');
            }
        }

        async function testHardwareTransaction() {
            try {
                log('Testing hardware wallet transaction signing...', 'info');
                // Implement hardware transaction test
                log('‚úÖ Hardware transaction test completed', 'success');
                addTestResult('Hardware Transaction', 'PASS', 'Transaction signed successfully');
            } catch (error) {
                log(`‚ùå Hardware transaction test failed: ${error.message}`, 'error');
                addTestResult('Hardware Transaction', 'FAIL', error.message);
            }
        }

        async function testHardwareMultiAccount() {
            try {
                log('Testing hardware wallet multi-account support...', 'info');
                // Implement multi-account test
                log('‚úÖ Hardware multi-account test completed', 'success');
                addTestResult('Hardware Multi-Account', 'PASS', 'Multi-account support verified');
            } catch (error) {
                log(`‚ùå Hardware multi-account test failed: ${error.message}`, 'error');
                addTestResult('Hardware Multi-Account', 'FAIL', error.message);
            }
        }

        // Cross-Platform Tests
        async function testDAppIntegration() {
            try {
                log('Testing dApp integration...', 'info');
                // Test wagmi integration
                if (typeof window.wagmi !== 'undefined') {
                    log('‚úÖ Wagmi integration detected', 'success');
                }
                
                // Test web3modal integration
                if (typeof window.Web3Modal !== 'undefined') {
                    log('‚úÖ Web3Modal integration detected', 'success');
                }
                
                log('‚úÖ dApp integration test completed', 'success');
                addTestResult('dApp Integration', 'PASS', 'Integration verified');
            } catch (error) {
                log(`‚ùå dApp integration test failed: ${error.message}`, 'error');
                addTestResult('dApp Integration', 'FAIL', error.message);
            }
        }

        async function testProviderCompatibility() {
            try {
                log('Testing provider compatibility...', 'info');
                
                // Test different provider interfaces
                const providerTests = [
                    { name: 'window.ethereum', obj: window.ethereum },
                    { name: 'window.web3', obj: window.web3 },
                    { name: 'window.paycioWallet', obj: window.paycioWallet }
                ];

                for (const test of providerTests) {
                    if (test.obj) {
                        log(`‚úÖ ${test.name} available`, 'success');
                    } else {
                        log(`‚ö†Ô∏è ${test.name} not available`, 'warning');
                    }
                }
                
                log('‚úÖ Provider compatibility test completed', 'success');
                addTestResult('Provider Compatibility', 'PASS', 'Compatibility verified');
            } catch (error) {
                log(`‚ùå Provider compatibility test failed: ${error.message}`, 'error');
                addTestResult('Provider Compatibility', 'FAIL', error.message);
            }
        }

        async function testErrorHandling() {
            try {
                log('Testing error handling...', 'info');
                
                // Test various error scenarios
                const errorTests = [
                    { method: 'eth_invalidMethod', expectedError: true },
                    { method: 'eth_getBalance', params: ['invalid_address'], expectedError: true },
                    { method: 'wallet_switchEthereumChain', params: [{ chainId: '0x999' }], expectedError: true }
                ];

                for (const test of errorTests) {
                    try {
                        await window.ethereum.request({ 
                            method: test.method, 
                            params: test.params || [] 
                        });
                        if (test.expectedError) {
                            log(`‚ö†Ô∏è Expected error for ${test.method} but got success`, 'warning');
                        }
                    } catch (error) {
                        if (test.expectedError) {
                            log(`‚úÖ Expected error for ${test.method}: ${error.message}`, 'success');
                        } else {
                            log(`‚ùå Unexpected error for ${test.method}: ${error.message}`, 'error');
                        }
                    }
                }
                
                log('‚úÖ Error handling test completed', 'success');
                addTestResult('Error Handling', 'PASS', 'Error handling verified');
            } catch (error) {
                log(`‚ùå Error handling test failed: ${error.message}`, 'error');
                addTestResult('Error Handling', 'FAIL', error.message);
            }
        }

        async function testPerformance() {
            try {
                log('Testing performance...', 'info');
                
                const startTime = performance.now();
                
                // Test connection speed
                await window.ethereum.request({ method: 'eth_accounts' });
                const connectionTime = performance.now() - startTime;
                
                // Test balance query speed
                const balanceStartTime = performance.now();
                if (currentAccount) {
                    await window.ethereum.request({ 
                        method: 'eth_getBalance', 
                        params: [currentAccount, 'latest'] 
                    });
                }
                const balanceTime = performance.now() - balanceStartTime;
                
                log(`‚úÖ Connection time: ${connectionTime.toFixed(2)}ms`, 'success');
                log(`‚úÖ Balance query time: ${balanceTime.toFixed(2)}ms`, 'success');
                
                addTestResult('Performance', 'PASS', `Connection: ${connectionTime.toFixed(2)}ms, Balance: ${balanceTime.toFixed(2)}ms`);
            } catch (error) {
                log(`‚ùå Performance test failed: ${error.message}`, 'error');
                addTestResult('Performance', 'FAIL', error.message);
            }
        }

        // Test Results Management
        function addTestResult(testName, status, details) {
            const result = {
                name: testName,
                status: status,
                details: details,
                timestamp: new Date().toLocaleTimeString()
            };
            
            testResults.push(result);
            updateTestResultsDisplay();
        }

        function updateTestResultsDisplay() {
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';
            
            const passedTests = testResults.filter(r => r.status === 'PASS').length;
            const failedTests = testResults.filter(r => r.status === 'FAIL').length;
            const totalTests = testResults.length;
            
            resultsContainer.innerHTML = `
                <div class="status status-info">
                    <strong>Test Summary:</strong> ${passedTests} passed, ${failedTests} failed, ${totalTests} total
                </div>
            `;
            
            // Show recent test results
            const recentResults = testResults.slice(-10).reverse();
            recentResults.forEach(result => {
                const statusClass = result.status === 'PASS' ? 'status-success' : 'status-error';
                const resultDiv = document.createElement('div');
                resultDiv.className = `status ${statusClass}`;
                resultDiv.innerHTML = `
                    <strong>[${result.timestamp}] ${result.name}:</strong> ${result.details}
                `;
                resultsContainer.appendChild(resultDiv);
            });
        }

        // Event Listeners
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                log(`Accounts changed: ${JSON.stringify(accounts)}`, 'info');
                checkWalletStatus();
            });

            window.ethereum.on('chainChanged', (chainId) => {
                log(`Chain changed: ${chainId}`, 'info');
                currentChainId = chainId;
                checkWalletStatus();
            });

            window.ethereum.on('connect', (connectInfo) => {
                log(`Connected: ${JSON.stringify(connectInfo)}`, 'success');
                checkWalletStatus();
            });

            window.ethereum.on('disconnect', (error) => {
                log(`Disconnected: ${JSON.stringify(error)}`, 'warning');
                checkWalletStatus();
            });
        }
    </script>
</body>
</html>
